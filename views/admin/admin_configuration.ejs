<!DOCTYPE html>
<html lang="en">

<head>
    <title>Admin Konsole</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/javascripts/jquery-3.1.1.min.js"></script>
    <script src="/javascripts/bootstrap/bootstrap.bundle.js"></script>
    <link rel="stylesheet" href="/stylesheets/css/bootstrap.min.css">

    <script>
        function setCheckbox(id, state) {
            document.getElementById(id).disabled = state;
            if (state) {
                document.getElementById(id).checked = false;
            }
        }
    </script>

</head>

<body>

    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <!-- Brand/logo -->
        <a class="navbar-brand" href="/">Home</a>

        <!-- Links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/admin">System</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/statistics">Statistik</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/orderdata">Bestelldaten</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/configuration">Stammdaten</a>
            </li>
        </ul>
    </nav>
    <br>


    <div class="row px-2">
        <div class="col-2">
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <a class="nav-link active" id="v-pills-tables-tab" data-toggle="pill" href="#v-pills-tables" role="tab"
                    aria-controls="v-pills-home" aria-selected="true">Tische</a>
                <a class="nav-link" id="v-pills-organization-tab" data-toggle="pill" href="#v-pills-organization"
                    role="tab" aria-controls="v-pills-organization" aria-selected="false">Organisation</a>
                <a class="nav-link" id="v-pills-products-tab" data-toggle="pill" href="#v-pills-products" role="tab"
                    aria-controls="v-pills-products" aria-selected="false">Produkte</a>
            </div>
        </div>
        <div class="col-10">
            <div class="tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade show active" id="v-pills-tables" role="tabpanel"
                    aria-labelledby="v-pills-tables-tab">
                    <div class="card">
                        <div class="card-header">
                            Tisch Gruppen
                        </div>
                        <div class="card-body">
                            <div class="form-check">
                                <form action="configuration" method="POST">
                                    <div class="form-check">
                                        <label for="new_table_group">Neue Tisch Gruppe:</label>
                                        <input type="text" class="form-control" id="new_table_group"
                                            name="new_table_group" required>
                                        <br>
                                        <button class="btn btn-primary" onclick="this.form.submit()"> Neue Tisch Gruppe
                                            anlegen</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="card-body">
                            Tisch Gruppen:
                            <div class="list-group overflow-auto" style="max-height: 150px">
                                <% if(table_groups.length){ for(var i=0; i< table_groups.length; i++) {%>
                                <div class="list-group-item">
                                    <td>
                                        <%= table_groups[i].groupname%>
                                        <div class="float-right">
                                            <form action="configuration" method="POST">
                                                <button class="btn btn-danger btn-sm" id="remove_table_group"
                                                    name="remove_table_group" value="<%= table_groups[i].id%>"
                                                    onclick="this.form.submit()">
                                                    X
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </div>
                                <% } }else{ %>
                                <div class="list-group-item">
                                    Keine Tisch Gruppen definiert
                                </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="card">
                        <div class="card-header">
                            Tische
                        </div>
                        <div class="card-body">
                            <div class="form-check">
                                <form action="configuration" method="POST">
                                    <div class="form-check">
                                        <label for="new_table">Neuer Tisch:</label>
                                        <input type="text" class="form-control" id="new_table" name="new_table"
                                            required>
                                        <label class="form-check-label" for="table_group_id">Gruppe:</label>
                                        <select class="custom-select" id="table_group_id" name="table_group_id"
                                            required>
                                            <% if(table_groups.length){ for(var i=0; i< table_groups.length; i++) {%>
                                            <option value="<%= table_groups[i].id%>">
                                                <%= table_groups[i].groupname%>
                                            </option>
                                            <% } }else{ %>
                                            <option value="-1" selected>Leer</option>
                                            <% } %>
                                        </select>
                                        <br>
                                        <button class="btn btn-primary" onclick="this.form.submit()"> Neuen Tisch
                                            anlegen</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="card-body">
                            Tische:
                            <div class="list-group overflow-auto" style="max-height: 150px">
                                <% if(tables.length){ for(var i=0; i< tables.length; i++) {%>
                                <div class="list-group-item">
                                    <td>
                                        <%= tables[i].nummer%>
                                        <div class="float-right">
                                            <form action="configuration" method="POST">
                                                <button class="btn btn-danger btn-sm" id="remove_table"
                                                    name="remove_table" value="<%= tables[i].id%>"
                                                    onclick="this.form.submit()">
                                                    X
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </div>
                                <% } }else{ %>
                                <div class="list-group-item">
                                    Keine Tische definiert
                                </div>
                                <% } %>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="v-pills-organization" role="tabpanel"
                    aria-labelledby="v-pills-organization-tab">
                    <div class="card">
                        <div class="card-header">
                            Organisation
                        </div>
                        <div class="card-body">
                            <form action="#" method="POST">
                                <p>Neue Station:</p>
                                <input type="text" class="form-control" name="new_station" required>
                                <br>
                                <button class="btn btn-primary" type="submit"> Neue Station anlegen</button>
                            </form>
                            <br>
                            <p>Stationen:</p>
                            <div class="list-group overflow-auto" style="max-height: 150px" id="stations">
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="card">
                        <div class="card-header">
                            Alarm Typen
                        </div>
                        <div class="card-body">
                            <p>Neuer Alarm Typ:</p>
                            <form action="#" method="POST">
                                <input type="text" class="form-control" name="newAlertType" required>
                                <br>
                                <button type="submit" class="btn btn-primary"> Neuen Alarm Typ anlegen</button>
                            </form>
                            <br>
                            <p>Alarm Typen:</p>
                            <div class="list-group overflow-auto" id="alerttypes" style="max-height: 200px">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="v-pills-products" role="tabpanel" aria-labelledby="v-pills-products-tab">
                    <div class="card">
                        <div class="card-header">
                            Optionen
                        </div>
                        <div class="card-body">
                            <div class="form-check">
                                <form action="configuration" method="POST">
                                    <div class="form-check">
                                        <label for="new_option">Neue Zutat:</label>
                                        <input type="text" class="form-control" id="new_option" name="new_option"
                                            required>
                                        <br>
                                        <button class="btn btn-primary" onclick="this.form.submit()"> Neue Zutat
                                            anlegen</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="card-body">
                            Optionen:
                            <div class="list-group overflow-auto" style="max-height: 150px">
                                <% if(options.length){ for(var i=0; i< options.length; i++) {%>
                                <div class="list-group-item">
                                    <td>
                                        <%= options[i].name%>
                                    </td>
                                </div>
                                <% } }else{ %>
                                <div class="list-group-item">
                                    Keine Zutaten definiert
                                </div>
                                <% } %>
                            </div>
                        </div>
                    </div>

                    <br>

                    <div class="card">
                        <div class="card-header">
                            Produkte
                        </div>
                        <div class="card-body">
                            <div class="form-check">
                                <form action="configuration" method="POST">
                                    <label class="form-check-label" for="product_station">Station</label>
                                    <select class="custom-select" id="product_station" name="product_station" required>
                                    </select>
                                    <label for="product_name">
                                        Produktname
                                    </label>
                                    <input type="text" class="form-control" id="product_name" name="product_name"
                                        required>
                                    <label for="product_cost">
                                        Preis
                                    </label>
                                    <input type="number" class="form-control" id="product_cost" name="product_cost"
                                        required>
                                    <input type="checkbox" id="product_deliverable" name="product_deliverable" required>
                                    Lieferbar? oder Selbstabholung
                                    <br>
                                    Optionen
                                    <div class="list-group overflow-auto" style="max-height: 150px">
                                        <% if(options.length){ for(var i=0; i< options.length; i++) {%>
                                        <div class="list-group-item">
                                            <input type="checkbox" value="<%= options[i].id%>"
                                                id="product_option_<%= options[i].id%>" name="product_option"
                                                onclick="setCheckbox('product_option_standard_<%= options[i].id%>', !this.checked)">
                                            <%= options[i].name%>
                                            <input type="checkbox" value="<%= options[i].id%>"
                                                id="product_option_standard_<%= options[i].id%>"
                                                name="product_option_standard" disabled>
                                            Standard?
                                        </div>
                                        <% } }else{ %>
                                        <div class="list-group-item">
                                            Keine Zutaten vorhanden
                                        </div>
                                        <% } %>
                                    </div>
                                    <br>
                                    <button class="btn btn-primary" onclick="this.form.submit()"> Speichern</button>
                                </form>
                            </div>
                        </div>
                        <div class="card-body">
                            Produkte:
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Stand</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Preis</th>
                                        <th scope="col">Lieferbar?</th>
                                        <th scope="col">Entfernen</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if(products.length){ for(var i=0; i< products.length; i++) {%>
                                    <tr>
                                        <th scope="row">
                                            <%= products[i].id%>
                                        </th>
                                        <td>
                                            <%= products[i].id_stand%>
                                        </td>
                                        <td>
                                            <%= products[i].name%>
                                        </td>
                                        <td>
                                            <%= products[i].preis%>
                                        </td>
                                        <td>
                                            <% if(products[i].lieferbar==1){ %>
                                            <img src="/images/check.png" style="width:20px">
                                            <% }else{ %>
                                            <img src="/images/canceled.png" style="width:20px">
                                            <% } %>
                                        </td>
                                        <td>
                                            <form action="configuration" method="POST">
                                                <button class="btn btn-danger btn-sm" id="remove_product"
                                                    name="remove_product" value="<%= products[i].id%>"
                                                    onclick="this.form.submit()">
                                                    X
                                                </button>
                                            </form>

                                        </td>
                                    </tr>

                                    <% } }else{ %>

                                    Keine Produkte definiert

                                    <% } %>
                                </tbody>
                            </table>

                            <br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

<script>
    $(document).ready(function () {
        loadConfigurationData();
    });

    function loadConfigurationData() {
        $.ajax({
            url: "/data/alerttypes",
            success: (result) => {
                if (result.data.length > 0) {
                    result.data.forEach((element) => {
                        document.getElementById("alerttypes").innerHTML +=
                            '<div class="list-group-item">' + element.name +
                            '<form action="#" method="POST" style="display: inline;"><button class="btn btn-danger btn-sm float-right" name="deleteAlertType" value="' +
                            element.id + '">X</button></form><div>'
                    });
                } else {
                    document.getElementById("alerttypes").innerHTML +=
                        '<div class="list-group-item"> Keine Alarmtypen gefunden <div>'
                }
            }
        });

        $.ajax({
            url: "/data/getAllStations",
            success: (result) => {
                if (result.stations.length > 0) {
                    result.stations.forEach((element) => {
                        document.getElementById("stations").innerHTML +=
                            '<div class="list-group-item">' + element.name + '<div>'
                        document.getElementById("product_station").innerHTML += '<option value="'+element.id+'">'+element.name +'</option>'
                    });
                } else {
                    document.getElementById("stations").innerHTML +=
                        '<div class="list-group-item"> Keine Stationen gefunden <div>'
                    document.getElementById("product_station").innerHTML += '<option value="">Leer</option>'
                }
            }
        });

    }
</script>

</html>