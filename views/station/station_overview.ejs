<!DOCTYPE html>
<html lang="en">

<head>
    <title>Station</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/stylesheets/css/bootstrap.min.css" />
    <script src="/javascripts/jquery-3.1.1.min.js"></script>
    <script src="/javascripts/bootstrap/bootstrap.bundle.min.js"></script>
</head>

<body>
    <!-- Nav bar -->
    <nav class="navbar navbar-expand-ti navbar-dark bg-dark">
        <a class="navbar-brand" href="/">Ãœbersicht</a>
        <div class="navbar-brand flex-right">
            <%= station_name%>
        </div>
        <form action="#" method="POST">
            <button class="btn btn-outline-danger my-2 my-sm-0" type="submit" name="logout" value="true">
                Logout
            </button>
        </form>
    </nav>

    <div id="accordion">
        <div class="card">
            <a class="card-link card-header collapsed" data-toggle="collapse" href="#collapseOne"  onclick='changeCaret("caretfinished", "collapseOne")'>
                <img src="/images/caret-down-fill.svg"  id="caretfinished" style="width: 17px" />
                Abgeschlossene Bestellungen
                <div class="float-right">
                    <% if(pre_orders.length){%>
                    <%= pre_orders.length%>
                    <% } else {%> 0
                    <% }%>
                </div>
            </a>
            <div id="collapseOne" class="collapse" data-parent="#accordion">
                <div class="list-group pt-0" id="orders">
                    <% if(pre_orders.length){ %>
                    <% for(var i=0; i < pre_orders.length; i++) { %>
                    <div class="list-group-item" id="list_<%=pre_orders[i].b_id%>">
                    </div>
                    <% } %>
                    <% } else { %>
                    <div class="list-group-item">
                        <span>
                            Keine abgeschlossenen Bestellungen
                        </span>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
        <div class="card">
            <a class="card-link card-header" data-toggle="collapse" href="#collapseTwo" onclick='changeCaret("caretorders", "collapseTwo")'>
                <img src="/images/caret-up.png" id="caretorders" style="width: 17px" />
                Aktive Bestellungen
                <div class="float-right">
                    <% if(act_orders.length){ %>
                    <%= act_orders.length%>
                    <% } %>
                </div>
            </a>
            <div id="collapseTwo" class="collapse show" data-parent="#accordion">
                <div class="list-group pt-2 px-2">
                    <% if(act_orders.length){ %>
                    <% for(var i=0; i < act_orders.length; i++) { %>
                    <div class="list-group-item" id="list_<%=act_orders[i].b_id%>">
                    </div>
                    <% } %>
                    <% } else { %>
                    <div class="list-group-item">
                        <span>
                            Keine aktiven Bestellungen
                        </span>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Load first station entries
        $(document).ready(function () {
            const o = document.querySelectorAll(`[id^="list_"]`);
            o.forEach((element) => {
                console.log(element.id.split("_")[1])
                const i = element.id.split("_")[1];
                $("#list_" + i).load("/station/orderentry/" + i);
            });
        });

        // Automatically reload orders if no actions are made
        var idleTime;
        $(document).ready(function () {
            reloadPage();
            $('html').bind(
                'mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick',
                function () {
                    clearTimeout(idleTime);
                    reloadPage();
                });
        });

        function reloadPage() {
            clearTimeout(idleTime);
            idleTime = setTimeout(function () {
                location.reload();
            }, 60000);
        }

        // Change caret up/down
        function changeCaret(caret_id, check_id) {
            if (!caret_id || !check_id) {
                return;
            }
            if ($("#" + check_id).hasClass('show')) {
                document.getElementById(caret_id).src = "images/caret-down-fill.svg";
            } else {
                document.getElementById(caret_id).src = "images/caret-up.png";

            }
        };
    </script>
</body>

</html>